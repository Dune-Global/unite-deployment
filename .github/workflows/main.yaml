name: Update Submodules

on:
  push:
    branches:
      - main 
  repository_dispatch:
    types: [update-submodules]

jobs:
  update-submodules:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v2
      
    - name: Set up Git identity
      run: |
        git config --global user.email "wasath.vt@gmail.com"
        git config --global user.name "WasathTheekshana"
        
    - name: Update submodules
      run: |
        git submodule update --remote --recursive
        git add .
        
        # Check if there are changes in submodules
        if git diff-index --quiet HEAD --; then
          echo "No changes in submodules."
        else
          export GIT_AUTHOR_DATE="2024-02-10T12:00:00"
          export GIT_COMMITTER_DATE="2024-02-10T12:00:00"
          if git commit -m "Update submodules" --date="2024-02-10T12:00:00"; then
            git push
          else
            echo "Failed to commit changes."
            exit 1
          fi
        fi
